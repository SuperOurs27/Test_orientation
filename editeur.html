<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Éditeur de Course - Stratégie Navarre</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { display: flex; font-family: sans-serif; margin: 0; height: 100vh; }
        #map { flex: 2; height: 100%; cursor: crosshair; }
        #sidebar { flex: 1; padding: 20px; background: #2c3e50; color: white; overflow-y: auto; }
        .balise-item { background: #34495e; padding: 10px; margin-bottom: 10px; border-radius: 5px; position: relative; }
        input, textarea { width: 90%; margin-top: 5px; display: block; }
        button { cursor: pointer; margin-top: 10px; padding: 10px; font-weight: bold; }
        #export-area { width: 100%; height: 100px; margin-top: 20px; color: black; font-family: monospace; font-size: 10px; }
        .delete-btn { position: absolute; top: 5px; right: 5px; background: #e74c3c; color: white; border: none; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>

<div id="map"></div>
<div id="sidebar">
    <h2>Créateur de Course</h2>
    <p>1. Cliquez sur la carte pour ajouter une étape.<br>2. Remplissez les infos.<br>3. Copiez le code en bas.</p>
    <div id="liste-balises"></div>
    <hr>
    <h3>Code à copier :</h3>
    <textarea id="export-area" readonly></textarea>
    <p style="font-size: 0.8em; color: #bdc3c7;">Copiez ce texte et remplacez la section "balises" dans votre index.html</p>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    let map = L.map('map').setView([49.016, 1.116], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    let balises = [];
    let markers = [];

    map.on('click', function(e) {
        const newBalise = {
            id: balises.length + 1,
            nom: "Nouveau Point",
            lat: e.latlng.lat.toFixed(6),
            lng: e.latlng.lng.toFixed(6),
            enigme: "Quelle est la question ?",
            reponse: "Réponse",
            points: 20
        };
        balises.push(newBalise);
        render();
    });

    function render() {
        // Nettoyage
        markers.forEach(m => map.removeLayer(m));
        markers = [];
        document.getElementById('liste-balises').innerHTML = '';

        balises.forEach((b, index) => {
            // Ajouter marqueur
            let m = L.marker([b.lat, b.lng]).addTo(map).bindPopup("Étape " + (index+1));
            markers.push(m);

            // Ajouter formulaire dans sidebar
            let div = document.createElement('div');
            div.className = 'balise-item';
            div.innerHTML = `
                <strong>Étape ${index + 1}</strong>
                <button class="delete-btn" onclick="supprimer(${index})">X</button>
                <input type="text" value="${b.nom}" onchange="update(${index}, 'nom', this.value)" placeholder="Nom">
                <input type="text" value="${b.enigme}" onchange="update(${index}, 'enigme', this.value)" placeholder="Énigme">
                <input type="text" value="${b.reponse}" onchange="update(${index}, 'reponse', this.value)" placeholder="Réponse">
                <input type="number" value="${b.points}" onchange="update(${index}, 'points', parseInt(this.value))">
                <small>${b.lat}, ${b.lng}</small>
            `;
            document.getElementById('liste-balises').appendChild(div);
        });

        // Générer le code JSON
        document.getElementById('export-area').value = JSON.stringify(balises, null, 4);
    }

    function update(index, key, value) {
        balises[index][key] = value;
        document.getElementById('export-area').value = JSON.stringify(balises, null, 4);
    }

    function supprimer(index) {
        balises.splice(index, 1);
        render();
    }
</script>
</body>
</html>
